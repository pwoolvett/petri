[flake8]
max-line-length = 88

[tox]
envlist = black, blacktest, unit, integration, docs,
skipsdist = True
skip_install = True

[testenv]
skip_install = true
whitelist_externals = poetry
envdir = {toxinidir}/.venv
passenv = PYPI_USER PYPI_PASS
basepython = python3.6
commands =
  poetry install -v


[testenv:venv]
recreate = False
description = "Install basic dependencies for working application, without running tests"

[testenv:bump]
description = "bump the version"

commands =
  poetry config repositories.pypi https://upload.pypi.org/legacy/
  poetry config http-basic.pypi {env:PYPI_USER} {env:PYPI_PASS}
  poetry build
  poetry version {posargs} > git tag
  git push

[testenv:black]
description = "reformat code"
commands =
  black --py36 petri

[testenv:blacktest]
description = "reformat testing code"
commands =
  black --py36 tests

[testenv:unit]
description = "Run unit tests"

commands =
  pytest {posargs} -v --tb=short -ra --cov=petri tests/unit
  coverage xml -o coverage.unit.xml

[testenv:docs]
description = "invoke sphinx-build to build the HTML docs"
commands =
  sphinx-build \
  -d "{toxinidir}/docs/build/.doctrees" \
  "{toxinidir}/docs/source" \
  "{toxinidir}/docs/build" \
  --color \
  -E \
  -a \
;  -W \
  -bhtml
